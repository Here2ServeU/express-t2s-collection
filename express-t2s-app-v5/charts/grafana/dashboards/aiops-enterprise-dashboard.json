{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "__requires": [
    {
      "type": "grafana",
      "id": "grafana",
      "name": "Grafana",
      "version": "10.0.0"
    },
    {
      "type": "panel",
      "id": "timeseries",
      "name": "Time series",
      "version": ""
    },
    {
      "type": "panel",
      "id": "bargauge",
      "name": "Bar gauge",
      "version": ""
    },
    {
      "type": "panel",
      "id": "stat",
      "name": "Stat",
      "version": ""
    },
    {
      "type": "panel",
      "id": "table",
      "name": "Table",
      "version": ""
    },
    {
      "type": "panel",
      "id": "piechart",
      "name": "Pie chart",
      "version": ""
    },
    {
      "type": "datasource",
      "id": "prometheus",
      "name": "Prometheus",
      "version": "2.0.0"
    }
  ],
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {
          "type": "grafana",
          "uid": "-- Grafana --"
        },
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "iteration": 1,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "title": "Summary – Platform Health",
      "type": "stat",
      "id": 1,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 4, "w": 6, "x": 0, "y": 0 },
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{app=\"express-web-app\"}[5m]))",
          "refId": "A"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "value_and_name"
      },
      "description": "Current request rate for Express Web App (RPS)."
    },
    {
      "title": "Summary – AIOps Requests per Minute",
      "type": "stat",
      "id": 2,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 4, "w": 6, "x": 6, "y": 0 },
      "targets": [
        {
          "expr": "sum(rate(aiops_requests_total[5m])) * 60",
          "refId": "A"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "value_and_name"
      },
      "description": "AIOps prediction and FinOps calls per minute."
    },
    {
      "title": "Summary – Estimated Monthly Cost (AIOps)",
      "type": "stat",
      "id": 3,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 4, "w": 6, "x": 12, "y": 0 },
      "targets": [
        {
          "expr": "avg_over_time(aiops_estimated_monthly_cost[5m])",
          "refId": "A"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "value_and_name"
      },
      "description": "Average estimated monthly cost based on AIOps FinOps estimator."
    },
    {
      "title": "Summary – Critical Vulnerabilities (DevSecOps)",
      "type": "stat",
      "id": 4,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 4, "w": 6, "x": 18, "y": 0 },
      "targets": [
        {
          "expr": "sum(devsecops_vulnerabilities_total{severity=\"CRITICAL\"})",
          "refId": "A"
        }
      ],
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "center",
        "orientation": "horizontal",
        "reduceOptions": {
          "calcs": ["lastNotNull"],
          "fields": "",
          "values": false
        },
        "textMode": "value_and_name"
      },
      "description": "Total critical vulnerabilities from latest Trivy DevSecOps scan."
    },
    {
      "title": "Express Web App – Request Rate (RPS)",
      "type": "timeseries",
      "id": 5,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 4 },
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{app=\"express-web-app\"}[1m]))",
          "refId": "A",
          "legendFormat": "express-web-app"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "description": "Incoming traffic to the Express Web App. Run generate-traffic.sh and watch this spike."
    },
    {
      "title": "Express Web App – Error Rate",
      "type": "timeseries",
      "id": 6,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 4 },
      "targets": [
        {
          "expr": "sum(rate(http_request_errors_total{app=\"express-web-app\"}[1m]))",
          "refId": "A",
          "legendFormat": "errors"
        }
      ],
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        }
      },
      "description": "Application-level error rate for the Express Web App."
    },
    {
      "title": "Express Web App – P95 Latency",
      "type": "timeseries",
      "id": 7,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 10 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_seconds_bucket{app=\"express-web-app\"}[5m])) by (le))",
          "refId": "A",
          "legendFormat": "p95 latency"
        }
      ],
      "description": "Ninety-fifth percentile latency for Express Web App requests. This rises when generate-traffic.sh is executed."
    },
    {
      "title": "Express Web App – CPU and Memory",
      "type": "timeseries",
      "id": 8,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 10 },
      "targets": [
        {
          "expr": "sum(rate(container_cpu_usage_seconds_total{pod=~\"express-web-app.*\"}[5m]))",
          "refId": "A",
          "legendFormat": "CPU cores"
        },
        {
          "expr": "sum(container_memory_working_set_bytes{pod=~\"express-web-app.*\"})",
          "refId": "B",
          "legendFormat": "Memory bytes"
        }
      ],
      "description": "Container CPU and memory usage for the Express Web App pods."
    },
    {
      "title": "AIOps – Requests by Endpoint",
      "type": "timeseries",
      "id": 9,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 16 },
      "targets": [
        {
          "expr": "sum(rate(aiops_requests_total[1m])) by (endpoint)",
          "refId": "A",
          "legendFormat": "{{endpoint}}"
        }
      ],
      "description": "AIOps endpoints traffic: /predict and /finops. Peaks when generate-traffic.sh or UI interactions run."
    },
    {
      "title": "AIOps – P95 Latency by Endpoint",
      "type": "timeseries",
      "id": 10,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 16 },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate(aiops_request_latency_seconds_bucket[5m])) by (le, endpoint))",
          "refId": "A",
          "legendFormat": "p95 {{endpoint}}"
        }
      ],
      "description": "Ninety-fifth percentile latency for AIOps endpoints."
    },
    {
      "title": "AIOps – Risk Score Distribution (Derived)",
      "type": "bargauge",
      "id": 11,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 22 },
      "targets": [
        {
          "expr": "sum(aiops_requests_total{severity=\"low\"})",
          "refId": "A",
          "legendFormat": "low"
        },
        {
          "expr": "sum(aiops_requests_total{severity=\"medium\"})",
          "refId": "B",
          "legendFormat": "medium"
        },
        {
          "expr": "sum(aiops_requests_total{severity=\"high\"})",
          "refId": "C",
          "legendFormat": "high"
        }
      ],
      "description": "Distribution of AIOps-classified risk by severity. Requires exporting severity labels as metrics when serving predictions."
    },
    {
      "title": "FinOps – CPU vs Memory Cost",
      "type": "timeseries",
      "id": 12,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 22 },
      "targets": [
        {
          "expr": "sum(aiops_cpu_cost)",
          "refId": "A",
          "legendFormat": "CPU cost"
        },
        {
          "expr": "sum(aiops_memory_cost)",
          "refId": "B",
          "legendFormat": "Memory cost"
        }
      ],
      "description": "Cost split between CPU and memory based on AIOps FinOps heuristics."
    },
    {
      "title": "FinOps – Estimated Monthly Cost Trend",
      "type": "timeseries",
      "id": 13,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 22 },
      "targets": [
        {
          "expr": "aiops_estimated_monthly_cost",
          "refId": "A",
          "legendFormat": "estimated monthly cost"
        }
      ],
      "description": "Time series of estimated monthly cost based on AIOps FinOps estimator. Run finops-test.sh before presenting this panel."
    },
    {
      "title": "DevSecOps – Vulnerabilities by Severity",
      "type": "piechart",
      "id": 14,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 8, "x": 0, "y": 28 },
      "targets": [
        {
          "expr": "sum(devsecops_vulnerabilities_total) by (severity)",
          "refId": "A",
          "legendFormat": "{{severity}}"
        }
      ],
      "description": "Snapshot of vulnerabilities discovered by Trivy scans grouped by severity."
    },
    {
      "title": "DevSecOps – Vulnerabilities Over Time",
      "type": "timeseries",
      "id": 15,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 8, "x": 8, "y": 28 },
      "targets": [
        {
          "expr": "sum(devsecops_vulnerabilities_total) by (severity)",
          "refId": "A",
          "legendFormat": "{{severity}}"
        }
      ],
      "description": "Trend of vulnerabilities by severity level across multiple Trivy scans. Run trivy-scan.sh to populate."
    },
    {
      "title": "Kubernetes – Top Pods by CPU (mCores)",
      "type": "table",
      "id": 16,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 8, "x": 16, "y": 28 },
      "targets": [
        {
          "expr": "topk(10, sum(rate(container_cpu_usage_seconds_total{image!=\"\"}[5m])) by (pod))",
          "refId": "A"
        }
      ],
      "description": "Top 10 pods by CPU usage. Shows which workloads are most expensive during traffic tests."
    },
    {
      "title": "Kubernetes – Node CPU Utilization",
      "type": "timeseries",
      "id": 17,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 34 },
      "targets": [
        {
          "expr": "avg(rate(node_namespace_pod_container:container_cpu_usage_seconds_total:sum_rate[5m])) by (instance)",
          "refId": "A",
          "legendFormat": "node {{instance}}"
        }
      ],
      "description": "Average CPU utilization per node in the EKS cluster."
    },
    {
      "title": "Kubernetes – Node Memory Utilization",
      "type": "timeseries",
      "id": 18,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 34 },
      "targets": [
        {
          "expr": "1 - (avg(node_memory_MemAvailable_bytes) / avg(node_memory_MemTotal_bytes))",
          "refId": "A",
          "legendFormat": "node mem utilization"
        }
      ],
      "description": "Node-level memory utilization for the EKS cluster."
    },
    {
      "title": "Kubernetes – Pod Restarts (Instability)",
      "type": "timeseries",
      "id": 19,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 0, "y": 40 },
      "targets": [
        {
          "expr": "sum(increase(kube_pod_container_status_restarts_total[15m])) by (pod)",
          "refId": "A",
          "legendFormat": "{{pod}}"
        }
      ],
      "description": "Pod restarts in the last 15 minutes. Useful for correlating with AIOps-detected incidents."
    },
    {
      "title": "Express Web App – HTTP Status Codes",
      "type": "bargauge",
      "id": 20,
      "datasource": "${DS_PROMETHEUS}",
      "gridPos": { "h": 6, "w": 12, "x": 12, "y": 40 },
      "targets": [
        {
          "expr": "sum(rate(http_requests_total{app=\"express-web-app\"}[5m])) by (status)",
          "refId": "A",
          "legendFormat": "{{status}}"
        }
      ],
      "description": "Distribution of HTTP status codes from the Express Web App over the last 5 minutes."
    }
  ],
  "refresh": "10s",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["express-web-app", "aiops", "finops", "devsecops", "enterprise-demo"],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-30m",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Express Web App v6 – Enterprise AIOps / FinOps / DevSecOps Dashboard",
  "uid": null,
  "version": 1,
  "weekStart": ""
}
